class Maze{constructor(t=10,s=10,i=30){this.w=t,this.h=s,this.size=i,this.width=2*t-1,this.height=2*s-1,this.timeTooken=0,this.canvas=new Canvas(i*this.width,i*this.height),this.canvas.start(),this.colors={background:"#3d3d3d",path:"#ffffff"},this.solution=[],this.done=!1,this.not_visited=[],this.cells={},this.solved=!1,this.board={},this.stack=[];for(var h=0;h<this.width;h++)for(var e=0;e<this.height;e++)this.board[this.num([h,e])]=h%2==0&&e%2==0?0:1}num(t){return t[0]+t[1]*this.width}coord(t){return[t%this.width,Math.floor(t/this.width)]}printBoard(){for(var t="",s=0;s<this.width*this.height;s++)0==this.board[s]?t+="  ":1==this.board[s]?t+="â–  ":t+="X ",s%this.width==this.width-1&&(t+="\n");console.log(t)}draw(){for(var t=0;t<this.width*this.height;t++){var s=this.coord(t);0==this.board[t]?this.canvas.rect(this.size,this.size,s[0]*this.size,s[1]*this.size,this.colors.path).draw():1==this.board[t]?this.canvas.rect(this.size,this.size,s[0]*this.size,s[1]*this.size,this.colors.background).draw():2==this.board[t]?this.canvas.rect(this.size,this.size,s[0]*this.size,s[1]*this.size,"#ff0000").draw():3==this.board[t]&&this.canvas.rect(this.size,this.size,s[0]*this.size,s[1]*this.size,"#0000ff")}}nextStep(){var t=[[2,0],[-2,0],[0,2],[0,-2]];t.sort(()=>.5-Math.random());for(var s=3;s>=0;s--){var i=t[s];((e=[spawn[0]+i[0],spawn[1]+i[1]])[0]<0||e[0]>this.width||e[1]<0||e[1]>this.height)&&t.splice(s,1)}var h=[];for(var i of t){var e=[spawn[0]+i[0],spawn[1]+i[1]];-1!=this.not_visited.indexOf(this.num(e))&&h.push(e)}if(0==h){if(0!=maze.stack.length)this.stack.pop(),spawn=this.coord(this.stack.pop()),this.stack.push(this.num(spawn));else if(0==maze.stack.length)for(var i of(clearInterval(interval),this.not_visited))this.board[i]=1}else{h.sort(()=>.5-Math.random()),cell=h[0];var a=[(spawn[0]+cell[0])/2,(spawn[1]+cell[1])/2];this.board[this.num(a)]=0,this.stack.push(this.num(spawn)),this.not_visited.splice(this.not_visited.indexOf(this.num(cell)),1),this.cells[this.num(cell)].visited=!0,spawn=cell}}fastConstruct(){for(var t=0;t<this.width*this.height;t++){this.cells[t]=new Cell(t);var s=this.coord(t);s[0]%2==0&&s[1]%2==0&&this.not_visited.push(t)}this.not_visited.splice(0,1);t=0;var i,h=[0,0],e=performance.now(),a=setInterval(()=>{for(var s=0;s<4e3;s++){if(0==this.not_visited.length){this.done=!0,this.solved&&this.solve(),this.timeTooken=e-performance.now(),clearInterval(a),maze.draw();break}var r=[[2,0],[-2,0],[0,2],[0,-2]];r.sort(()=>.5-Math.random());for(var o=3;o>=0;o--){var n=r[o];((c=[h[0]+n[0],h[1]+n[1]])[0]<0||c[0]>this.width||c[1]<0||c[1]>this.height)&&r.splice(o,1)}var d=[];for(var n of r){var c=[h[0]+n[0],h[1]+n[1]];-1!=this.not_visited.indexOf(this.num(c))&&d.push(c)}if(0==d)0!=maze.stack.length&&(this.stack.pop(),h=this.coord(this.stack.pop()),this.stack.push(this.num(h)));else{d.sort(()=>.5-Math.random()),i=d[0];var v=[(h[0]+i[0])/2,(h[1]+i[1])/2];this.board[this.num(v)]=0,this.stack.push(this.num(h)),this.not_visited.splice(this.not_visited.indexOf(this.num(i)),1),this.cells[this.num(i)].visited=!0,h=i}t++}},1)}constructMaze(){for(var t=0;t<this.width*this.height;t++){this.cells[t]=new Cell(t);var s=this.coord(t);s[0]%2==0&&s[1]%2==0&&this.not_visited.push(t)}this.not_visited.splice(0,1);t=0;var i,h=[0,0],e=performance.now(),a=setInterval(()=>{if(this.canvas.clear(),0==maze.not_visited.length)return this.done=!0,this.solved&&this.solve(),this.timeTooken=e-performance.now(),void clearInterval(a);var s=[[2,0],[-2,0],[0,2],[0,-2]];s.sort(()=>.5-Math.random());for(var r=3;r>=0;r--){var o=s[r];((d=[h[0]+o[0],h[1]+o[1]])[0]<0||d[0]>this.width||d[1]<0||d[1]>this.height)&&s.splice(r,1)}var n=[];for(var o of s){var d=[h[0]+o[0],h[1]+o[1]];-1!=this.not_visited.indexOf(this.num(d))&&n.push(d)}if(0==n)0!=maze.stack.length&&(this.stack.pop(),h=this.coord(this.stack.pop()),this.stack.push(this.num(h)));else{n.sort(()=>.5-Math.random()),i=n[0];var c=[(h[0]+i[0])/2,(h[1]+i[1])/2];this.board[this.num(c)]=0,this.stack.push(this.num(h)),this.not_visited.splice(this.not_visited.indexOf(this.num(i)),1),this.cells[this.num(i)].visited=!0,h=i}t++,maze.draw()},1)}solve(){this.not_visited=[];for(var t=0;t<this.width*this.height;t++)0==this.board[t]&&this.not_visited.push(t);this.stack=[],this.not_visited.splice(0,1);t=0;var s=[0,0],i=(performance.now(),setInterval(()=>{if(this.canvas.clear(),this.num(s)==this.width*this.height-1){for(var h of(this.board[0]=2,this.stack))this.board[h]=2;return clearInterval(i),void maze.draw()}var e=[[1,0],[0,1],[-1,0],[0,-1]];e.sort(()=>.5-Math.random());for(var a=3;a>=0;a--){h=e[a];((r=[s[0]+h[0],s[1]+h[1]])[0]<0||r[0]>=this.width||r[1]<0||r[1]>=this.height||1==this.board[this.num(r)]||!this.not_visited.includes(this.num(r)))&&e.splice(a,1)}if(0==e.length)this.board[this.stack[this.stack.length-1]]=0,this.stack.pop(),s=this.coord(this.stack.pop()),this.stack.push(this.num(s));else{h=e[0];var r=[s[0]+h[0],s[1]+h[1]];this.stack.push(this.num(r)),this.not_visited.splice(this.not_visited.indexOf(this.num(r)),1),this.board[this.num(r)]=2,s=r}maze.draw(),t++},1))}toString(){for(var t=this.w+"-"+this.h+"-",s=0;s<this.width*this.height-1;s++)1==this.board[s]?t+="1":t+="0";return t}parseStr(t){var s=t.split("-");this.w=parseInt(s[0]),this.h=parseInt(s[1]),this.width=2*this.w-1,this.height=2*this.h-1,this.canvas.c.width=this.width*this.size,this.canvas.c.height=this.height*this.size;for(var i=0;i<s[2].length;i++)this.board[i]=parseInt(s[2][i])}fastSolve(){this.not_visited=[];for(var t=0;t<this.width*this.height;t++)0==this.board[t]&&this.not_visited.push(t);this.stack=[],this.not_visited.splice(0,1);t=0;var s=[0,0],i=performance.now(),h=setInterval(()=>{this.canvas.clear();for(var e=0;e<3e3;e++){if(this.num(s)==this.width*this.height-1){for(var a of(this.board[0]=2,this.stack))this.board[a]=2;return this.solveTime=performance.now()-i,clearInterval(h),void maze.draw()}var r=[[1,0],[0,1],[-1,0],[0,-1]];r.sort(()=>.5-Math.random());for(var o=3;o>=0;o--){a=r[o];((n=[s[0]+a[0],s[1]+a[1]])[0]<0||n[0]>=this.width||n[1]<0||n[1]>=this.height||1==this.board[this.num(n)]||!this.not_visited.includes(this.num(n)))&&r.splice(o,1)}if(0==r.length)this.board[this.stack[this.stack.length-1]]=0,this.stack.pop(),s=this.coord(this.stack.pop()),this.stack.push(this.num(s));else{a=r[0];var n=[s[0]+a[0],s[1]+a[1]];this.stack.push(this.num(n)),this.not_visited.splice(this.not_visited.indexOf(this.num(n)),1),this.board[this.num(n)]=2,s=n}t++}maze.draw()},1)}}class Cell{constructor(t){this.number=t,this.visited=!1}}
